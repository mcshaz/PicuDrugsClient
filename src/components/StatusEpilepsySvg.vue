<template>
  <!--unused namespaces:
    xmlns:osb="http://www.openswatchbook.org/uri/2009/osb"
    xmlns:xlink="http://www.w3.org/1999/xlink"  -->
<svg
    xmlns:dc="http://purl.org/dc/elements/1.1/"
    xmlns:cc="http://creativecommons.org/ns#"
    xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#"
    xmlns:svg="http://www.w3.org/2000/svg"
    xmlns="http://www.w3.org/2000/svg"
    id="status-epilepsy"
    version="1.1"
    viewBox="0 0 195 261" >

  <defs id="defs5101">
    <marker
        style="overflow:visible;"
        id="arrow"
        refX="0.0"
        refY="0.0"
        orient="auto">
      <path
          transform="rotate(90) scale(0.33,0.33)"
          d="M 0,0 5,4 0,-5 -5,4 Z"
          style="fill-rule:evenodd;stroke-width:0.625;stroke-linejoin:round;stroke:#ff0000;stroke-opacity:1;fill:#ff0000;fill-opacity:1"
          id="path881" />
    </marker>
    <path
        class="yellow"
        id="yesno"
        d="m 0,0 h 16 v 9 l 4,7 -4,-2 v 2 h -16 z" />
    <rect
        class="duration"
        id="duration"
        width="30"
        height="8"
        x="-15"
        y="0"
        rx="2"
        ry="2" />
    <filter
        style="color-interpolation-filters:sRGB;"
        inkscape:label="Drop Shadow"
        id="shadow">
      <feFlood
          flood-opacity="0.5"
          flood-color="rgb(0,0,0)"
          result="flood"
          id="feFlood11040" />
      <feComposite
          in="flood"
          in2="SourceGraphic"
          operator="in"
          result="composite1"
          id="feComposite11042" />
      <feGaussianBlur
          in="composite1"
          stdDeviation="0.5"
          result="blur"
          id="feGaussianBlur11044" />
      <feOffset
          dx="0.3"
          dy="0.3"
          result="offset"
          id="feOffset11046" />
      <feComposite
          in="SourceGraphic"
          in2="offset"
          operator="over"
          result="composite2"
          id="feComposite11048" />
    </filter>
  </defs>
  <metadata>
    <rdf:RDF>
      <cc:Work
          rdf:about="">
        <dc:format>image/svg+xml</dc:format>
        <dc:type
            rdf:resource="http://purl.org/dc/dcmitype/StillImage" />
        <dc:title>Paediatric Stutus Epilepticus</dc:title>
      </cc:Work>
    </rdf:RDF>
  </metadata>

  <text
      style="font-style:normal;font-variant:normal;font-weight:bold;font-stretch:normal;font-size:8.46666622px;font-family:Calibri;-inkscape-font-specification:Calibri-Bold;text-align:left;letter-spacing:0;word-spacing:0;writing-mode:lr-tb;text-anchor:start;fill:#000000;fill-opacity:1;fill-rule:nonzero;stroke:none;stroke-width:0.35277778"
      id="text5145"
      x="31.78253"
      y="10"
      class="list">Paediatric Status Epilepticus</text>

  <use href="#yesno" x="46" y="67" />
  <text
      style="font-style:normal;font-variant:normal;font-weight:bold;font-stretch:normal;font-size:6.3499999px;font-family:Calibri;-inkscape-font-specification:Calibri-Bold;text-align:center;letter-spacing:0;word-spacing:0;writing-mode:lr-tb;text-anchor:middle;fill:#000000;fill-opacity:1;fill-rule:nonzero;stroke:none;stroke-width:0.35277778"
      id="text5689"
      x="54"
      y="77">
    YES
  </text>

  <use href="#yesno" x="-177" y="67" transform="scale(-1,1)" />
  <text
      style="font-style:normal;font-variant:normal;font-weight:bold;font-stretch:normal;font-size:6.3499999px;font-family:Calibri;-inkscape-font-specification:Calibri-Bold;text-align:center;letter-spacing:0;word-spacing:0;writing-mode:lr-tb;text-anchor:middle;fill:#000000;fill-opacity:1;fill-rule:nonzero;stroke:none;stroke-width:0.35277778"
      id="text5701"
      x="169"
      y="77">
    NO
  </text>

  <path
      class="call-help"
      d="m 2,18 h 33 v 26 h -12 v 6 h 4 l -8.5,7.5 -8.5,-7.5 h 4 v -6 h -12 z"
      id="path8771"/>

  <text
      x="18.5"
      y="30.739502"
      class="strong">
    <tspan
        style="stroke-width:0.35277778">Call for help:</tspan>
    <tspan
        x="18.5"
        dy="1.2em">777</tspan>
  </text>

  <rect
      class="call-help"
      id="rect8769"
      width="37.370808"
      height="78.00869"
      x="0.35277775"
      y="60.902283" />
  <text
      id="text5433"
      class="list strong"
      x="1"
      y="67">
    Consider
    <tspan
        x="1"
        dy="1.2em">
      treatable causes
    </tspan>
  </text>
  <text
      class="list"
      id="text5445"
      x="2"
      y="78">
    <tspan>- Hypoglycaemia</tspan>
    <tspan
        x="2"
        dy="1.1em">- Electrolyte</tspan>
    <tspan
        x="5"
        dy="1.1em">disturbance</tspan>
    <tspan
        x="2"
        dy="1.1em">- Meningitis/</tspan>
    <tspan
        x="5"
        dy="1.1em">Encephalitis</tspan>
    <tspan
        x="2"
        dy="1.1em">- Epilepsy</tspan>
    <tspan
        x="2"
        dy="1.1em">- Hypertensive</tspan>
    <tspan
        x="5"
        dy="1.1em">emergency</tspan>
    <tspan
        x="2"
        dy="1.1em">- Toxins</tspan>
    <tspan
        x="2"
        dy="1.1em">- Intracranial bleed</tspan>
    <tspan
        x="2"
        dy="1.1em">- Blocked shunt</tspan>
  </text>
  <path
      class="join"
      d="M 112,31.5 V 64.5"
      id="path6970"
      marker-end="url(#arrow)" />
  <path
      class="join"
      d="M 69,106 V 246"
      id="path6968"
      marker-end="url(#arrow)" />

  <path class="join" marker-end="url(#arrow)" d="M 156,150 H 116"/>
  <path class="join" marker-end="url(#arrow)" d="M 147,202 H 119"/>

  <path class="join" marker-end="url(#arrow)" d="M 156,112 V 162"/>
  <path class="join" d="M 156,190 V 195" marker-end="url(#arrow)" />

  <path class="join" marker-end="url(#arrow)" d="M 147,75.5 Q 156 75.5 156 86"/>
  <path class="join" marker-end="url(#arrow)" d="M 78,75.5 Q 69 75.5 69 86"/>

  <rect
      class="blue"
      id="abc"
      width="108"
      height="14.5"
      x="59"
      y="17"
      rx="3"
      ry="3" />
  <text
      class="strong"
      id="text5233"
      x="114"
      y="25.5">
    Assess ABC/Airway positioning/High flow O<tspan dy="0.2em">2</tspan>
  </text>

  <rect
      class="blue"
      id="glucose"
      width="108"
      height="14.5"
      x="59"
      y="34.5"
      rx="3"
      ry="3" />
  <text
      x="114"
      y="40.5">
    <tspan class="strong">
      Check blood glucose
    </tspan>
    <tspan x="114" dy="1.2em">If BSL &lt; 3.0 give 2ml/kg of 10% glucose</tspan>
  </text>

  <rect
      class="duration"
      id="gt5"
      width="74"
      height="8"
      x="75"
      y="52"
      rx="2"
      ry="2" />
  <text class="duration"
      x="112"
      y="57">Seizure greater than 5 minutes</text>

  <rect
      class="green"
      width="69"
      height="17"
      x="78"
      y="67"
      rx="3"
      ry="3" />
  <text
      class="strong"
      x="114"
      y="74">
    <tspan>Intravenous (IV) or</tspan>
    <tspan
        x="114"
        dy="1.2em">Intraosseous (IO) access?</tspan>
  </text>

  <rect
      class="peach"
      width="75"
      height="18"
      x="40"
      y="88"
      rx="3"
      ry="3" />
  <text
      id="text5557"
      x="78"
      y="95">
    <tspan
        class="drug">IV Midazolam 0.15mg/kg</tspan>
    <tspan class="em">(max 10mg)</tspan>
    <tspan class="em"
        x="78"
        dy="1.2em">(including pre-hospital treatment)
    </tspan>
  </text>

  <rect
      class="peach"
      width="75"
      height="24"
      x="118"
      y="88"
      rx="3"
      ry="3" />
  <text
      x="156"
      y="93">
    <tspan
        class="drug">IM Midazolam 0.2mg/kg</tspan>
    <tspan class="em">(max 10mg)</tspan>
    <tspan class="or"
        x="156"
        dy="1.2em">OR </tspan>
    <tspan>   or Intranasal Midazolam</tspan>
    <tspan
        x="156"
        dy="1.2em">0.5mg/kg</tspan>
    <tspan
        class="em" >(max 10mg)</tspan>
    <tspan
        x="156"
        dy="1.2em"
        class="em">(including pre-hospital treatment)</tspan>
  </text>

  <use href="#duration" x="69" y="119.5" />
  <text class="duration"
      x="70"
      y="125">
    5 minutes
  </text>

  <rect
      class="green"
      id="rect4885"
      width="71.376572"
      height="20.41399"
      x="122.19438"
      y="115.18371"
      rx="3"
      ry="3" />
  <text
      class="drug"
      x="158"
      y="121">
    <tspan>Achieve IV access or if seizure</tspan>
    <tspan
        x="158"
        dy="1.2em">continues after further 5 minutes</tspan>
    <tspan
        x="158"
        dy="1.2em">and no IV access insert IO</tspan>
  </text>

  <use href="#duration" x="161" y="139" />
  <text class="duration"
      x="161.5"
      y="144.5">10 minutes
  </text>

  <rect
      class="green"
      width="23"
      height="15"
      x="121"
      y="142"
      rx="3"
      ry="3" />
  <text
      class="drug"
      x="133"
      y="148">
    <tspan>IV or IO</tspan>
    <tspan
        x="133"
        dy="1.2em">access</tspan>
  </text>

  <rect
      class="peach"
      id="rect4891"
      width="74"
      height="18"
      x="40"
      y="139"
      rx="3"
      ry="3" />
  <text
      x="78"
      y="146">
    <tspan class="drug">IV Midazolam 0.15mg/kg</tspan>
    <tspan
        class="em">(max 10mg)</tspan>
    <tspan class="em"
        x="78"
        dy="1.2em">(including pre-hospital treatment)</tspan>
  </text>

  <use href="#duration" x="69" y="160.5" />
  <text class="duration"
      x="70"
      y="166">5 minutes
  </text>

  <rect
      class="peach"
      width="107"
      height="34"
      x="10"
      y="172"
      rx="3"
      ry="3" />
  <text
      x="64"
      y="177">
    <tspan class="drug">IV Levetiracetam 40mg/kg</tspan>
    <tspan
        class="em">(max 3g)</tspan>
    <tspan class="small"
        x="64"
        dy="1em">Dilute 1:1 with 0.9% sodium chloride to a minimum volume of 10ml and</tspan>
    <tspan
        x="64" dy="1em">infused over 5 mins</tspan>
    <tspan class="or drug"
        x="64"
        dy="1.2em">OR </tspan>
    <tspan class="drug"> if already on Levetiracetam, then</tspan>
    <tspan class="drug"
        x="64"
        dy="1em">IV Phenytoin 20mg/kg over 20 minutes</tspan>
    <tspan class="em">(max 1g)</tspan>
    <tspan class="small"
        x="64"
        dy="1em">Dilute 1:1 with 0.9% sodium chloride to a minimum volume of 20ml and</tspan>
    <tspan
        x="64" dy="1em">infused over 20 mins</tspan>
    <tspan class="junk" x="64" dy="1em">{{pivPheny}}</tspan>
  </text>

  <rect
      class="duration"
      width="55"
      height="8"
      x="43"
      y="211"
      rx="2"
      ry="2" />
  <text class="duration" x="71"
      y="216.5">5 minutes post infusion
  </text>

  <rect
      class="peach"
      width="180"
      height="20"
      x="11"
      y="223"
      rx="3"
      ry="3" />
  <text
      x="101"
      y="227">
    <tspan
        class="drug">IV Phenytoin 20mg/kg over 20 minutes if not given above</tspan>
    <tspan
        class="em">(max 1g)</tspan>
    <tspan
        class="or drug"
        dy="1em" x="101">OR </tspan>
    <tspan
        class="drug"> IV Levetiracetam 40mg/kg over 5 minutes if not given above</tspan>
    <tspan class="em">(max 3g)</tspan>
    <tspan
        class="drug" dy="1.1em" x="100">Prepare for Rapid Sequence Intubation (RSI):</tspan>
    <tspan dy="1em" x="101" class="small">Ensure CODE BLUE has been called, get RSI checklist and locate equipment, medications and personnel</tspan>
  </text>

  <rect
      class="peach"
      width="72"
      height="26"
      x="122"
      y="164"
      rx="3"
      ry="3" />
  <text
      x="159"
      y="171">
    <tspan
        class="drug">IM Midazolam 0.2mg/kg</tspan>
    <tspan
        class="em">(max 10mg)</tspan>
    <tspan class="or drug"
        x="159"
        dy="1em">OR </tspan>
    <tspan>   or Intranasal Midazolam</tspan>
    <tspan
        x="159"
        dy="1em">0.5mg/kg</tspan>
    <tspan
        class="em">(max 10mg)</tspan>
    <tspan class="em"
        x="159"
        dy="1em">(including pre-hospital treatment)</tspan>
  </text>

  <rect
      class="green"
      width="23"
      height="15"
      x="147"
      y="197"
      rx="3"
      ry="3" />
  <text
      class="drug"
      x="159"
      y="203" >
    <tspan>IV or IO</tspan>
    <tspan
        x="159"
        dy="1.2em">access</tspan>
  </text>

  <rect
      class="orange"
      width="180"
      height="12"
      x="11"
      y="248"
      rx="3"
      ry="3" />
  <text class="final"
      x="101"
      y="252">
    <tspan>Consider Rapid Sequence Intubation followed by Benzodiazepam infusion</tspan>
    <tspan class="or"
        x="101"
        dy="1.1em">OR </tspan>
    <tspan>4</tspan><tspan dy="-0.3em" class="small">th</tspan>
    <tspan dy="0.2em"> line anticonvulsant (sodium valproate/phenobarbitone) if intubation not appropriate</tspan>
  </text>

</svg>

</template>
<script lang="ts">
import 'reflect-metadata';
import { Component, Prop, Vue, Watch, Inject } from 'vue-property-decorator';
import { getAdenosineDoses, IDoseInfo, ampuleDescription } from '@/services/infusion-calculations/Transformations/Calculations/adenosine';
// import { NumericRange } from '@/services/infusion-calculations/Utilities/NumericRange';
import { IDrugDB, IEntityInfusion, IEntityFixedInfusionDrug, IEntityDrugAmpuleConcentration, IEntityBolusDrug } from '@/services/drugDb';
import { filterFixedInfusionsForPt, transformFixedInfusions, FixedInfusionDrugVM, filterTransformBolusesForPt, IBolusDrugVM } from '@/services/infusion-calculations';
import { roundToFixed } from '@/services/infusion-calculations/Utilities/rounding';

type vueNumber = number | '';

@Component({ filters: { roundToFixed } })
export default class StatusEpilepsySvg extends Vue {
  @Prop({ required: true })
  public wtKg!: vueNumber;

  public leve: FixedInfusionDrugVM | null = null;
  public pivPheny: FixedInfusionDrugVM | null = null;
  public buccalMidaz: IBolusDrugVM | null = null;
  public imiMidaz: IBolusDrugVM | null = null;
  public ivMidaz: IBolusDrugVM | null = null;

  @Inject('db')
  private db!: IDrugDB;
  private pivPhenyDbData!: PromiseLike<IEntityInfusion | undefined>;
  private leveDbData!: PromiseLike<IEntityInfusion | undefined>;
  private buccalMidazDbData!: PromiseLike<IEntityBolusDrug | undefined>;
  private ivMidazDbData!: PromiseLike<IEntityBolusDrug | undefined>;
  private imiMidazDbData!: PromiseLike<IEntityBolusDrug | undefined>;

  public created() {
    this.leveDbData = this.db.infusionDrugs.get(1000);
    this.pivPhenyDbData = this.db.infusionDrugs.get(37);
    this.buccalMidazDbData = this.db.bolusDrugs.get(1001);
    this.ivMidazDbData = this.db.bolusDrugs.get(22);
    this.imiMidazDbData = this.db.bolusDrugs.get(26);
  }

  @Watch('wtKg')
  public updateInfusions() {
    this.getInfusions();
  }

  private async getInfusions() {
    if (this.wtKg) {
      const drugs = await Promise.all([this.leveDbData,
        this.pivPhenyDbData,
        this.ivMidazDbData,
        this.imiMidazDbData,
        this.buccalMidazDbData]);
      const wtSelectedInfusions = filterFixedInfusionsForPt(drugs.slice(0, 2) as IEntityFixedInfusionDrug[], this.wtKg)!;
      this.leve = transformFixedInfusions(this.wtKg, wtSelectedInfusions[0]);
      this.pivPheny = transformFixedInfusions(this.wtKg, wtSelectedInfusions[1]);
      const wtBoluses = filterTransformBolusesForPt(drugs.slice(2) as IEntityBolusDrug[], this.wtKg);
      this.ivMidaz = wtBoluses[0];
      this.imiMidaz = wtBoluses[1];
      this.buccalMidaz = wtBoluses[2];
    }
  }
}
</script>
<style scoped>
  /* <![CDATA[ */
  @namespace svg url(http://www.w3.org/2000/svg);
  rect {
    fill-opacity: 1;
    stroke-width: 0.7;
    stroke-linejoin:round;
    stroke-opacity: 1;
    filter: url(#shadow)
  }
  text {
    font-size: 4.23px;
    font-style: normal;
    font-weight: normal;
    font-family: Calibri, Helvetica, sans-serif;
    text-align: center;
    letter-spacing: 0;
    word-spacing: 0;
    writing-mode: lr-tb;
    text-anchor: middle;
  }
  .title-text {
    fill: #0e2c53;
    font-size: 32pt;
    font-weight: bold;
  }
  .heading {
    font-weight: bold;
    font-size: 16pt;
  }
  .strong {
    font-weight: bold;
    font-size: 5px;
  }

  .em {
    font-style: italic;
  }

  .small {
    font-size: 3.6px;
  }

  text.duration, .drug {
    font-weight: bold;
    font-size: 4.5px;
  }
  .final {
    font-size: 4.5px;
    font-weight: bold;
    fill: white;
  }
  .or {
    fill: red;
  }
  .final .or {
    fill: lightgreen;
  }
  line, .join {
    stroke-width: 1;
    stroke: #ff0000;
    fill: none;
  }
  text.list {
    text-anchor: start;
    text-align: left;
  }
  .call-help {
    fill: #eefb9f;
    stroke: #ffcc00;
    stroke-width: 0.4;
  }
  rect.call-help {
    filter: none;
  }
  rect.duration {
    fill: #ffffff;
    stroke: #359b6d;
  }
  .peach {
    fill: #fdeada;
    stroke: #e46c0a;
  }
  .green {
    fill: #bdf5e4;
    stroke: #359b6d;
  }
  .blue {
    fill: #92d9fc;
    stroke: #385d8a;
  }
  .yellow {
    fill: #ffff00;
    stroke: #ffcc00;
    stroke-width: 0.4;
  }
  .orange {
    fill: #e46c0a;
    stroke: #e46c0a;
  }
  .title {
    fill:#FFF;
    stroke: #0e2c53;
  }

  svg|a:link, svg|a:visited {
    cursor: pointer;
  }

  svg|a text,
  text svg|a {
    fill: blue; /* Even for text, SVG uses fill over color */
    text-decoration: underline;
  }
  /* ]]> */
</style>
